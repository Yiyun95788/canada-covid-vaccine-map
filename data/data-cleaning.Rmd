---
title: "STA313 Final Project - Group 45"
---

```{r}
# Load necessary libraries
library(dplyr)
library(tidyr)

```

```{r}
# Load the database
vaccinations <- read.csv("vaccination-administration-bydosenumber_grouped.csv")
head(vaccinations)

# Provinces included in this database
unique_values <- vaccinations %>% distinct(prename)
unique_count <- n_distinct(vaccinations$prename)

unique_values
unique_count

```

```{r}
# Data Cleaning Processes

# Drop empty columns
vaccinations_simplified <- vaccinations %>% select(week_end, pruid, prename, vaccine_group, product_name, numtotal_totaldoses_admin, numtotal_dose1_admin, numtotal_dose2_admin, numtotal_dose3_admin, numtotal_dose4_admin, numtotal_dose5._admin, numtotal_dosenotreported_admin)

# Handle missing values
# Remove rows with missing values
vaccinations_cleaned <- na.omit(vaccinations_simplified)

```

```{r}
unique_groups <- vaccinations_cleaned %>% distinct(vaccine_group)
unique_groups

```

```{r}
# Log-transformed total doses admin
vaccinations_cleaned <- vaccinations_cleaned %>%
  mutate(log_total_doses = log(numtotal_totaldoses_admin))

# Histogram of numerical distribution
hist(vaccinations_cleaned$log_total_doses, main="Distribution of Total Doses Administered", xlab="Logged Total Doses", col="skyblue")

# Categorical distributions
vaccinations_cleaned %>% 
  count(vaccine_group) %>%
  ggplot(aes(x=reorder(vaccine_group, n), y=n)) +
  geom_bar(stat="identity", fill="steelblue") +
  coord_flip() +
  labs(title="Count of Vaccinations by Vaccine Group", x="Vaccine Group", y="Count")

# Time series analysis
vaccinations_cleaned %>%
  group_by(week_end) %>%
  summarise(total_doses = sum(numtotal_totaldoses_admin)) %>%
  ggplot(aes(x=as.Date(week_end), y=total_doses)) +
  geom_line(color="darkgreen") +
  labs(title="Total Doses Administered Over Time", x="Week End", y="Total Doses")

```

```{r}
library(scales)

```

```{r}
# Vaccinations by provinces
vaccinations_cleaned %>%
  filter(prename != "Canada") %>%
  group_by(prename) %>%
  ggplot(aes(x=reorder(prename, numtotal_totaldoses_admin), y=numtotal_totaldoses_admin)) +
  geom_bar(stat="identity", fill="purple") +
  coord_flip() +
  labs(title="Total Doses Administered by Province", x="Province", y="Total Doses") +
  scale_y_continuous(labels = comma)

```

```{r}
# Correlations between dose levels
dose_data <- vaccinations_cleaned %>% select(starts_with("numtotal_dose"))
corr_matrix <- cor(dose_data, use="complete.obs")
corrplot::corrplot(corr_matrix, method="circle")

# Detect for outliers
vaccinations_cleaned %>%
  select(starts_with("numtotal_dose")) %>%
  gather(dose_type, dose_value) %>%
  ggplot(aes(x=dose_type, y=dose_value)) +
  geom_boxplot(fill="orange") +
  labs(title="Distribution of Doses Administered by Type", x="Dose Type", y="Number of Doses")

```

```{r}
# Load required libraries
library(readr)
library(dplyr)
library(ggplot2)
library(scales)
library(lubridate)

# Read the CSV file
data <- read.csv("vaccination-administration-bydosenumber_grouped.csv")

# Filter and process the data
vaccination_trend <- data %>%
  # Filter only rows where product_name is "Total"
  filter(product_name == "Total") %>%
  # Convert week_end to Date type
  mutate(week_end = as.Date(week_end)) %>%
  # Group by month and get the last entry for each month
  group_by(month = floor_date(week_end, "month")) %>%
  slice(which.max(numtotal_totaldoses_admin))

# Create the plot
ggplot(vaccination_trend, aes(x = month, y = numtotal_totaldoses_admin)) +
  # Add the line
  geom_line(color = "#2563eb", size = 1) +
  # Add points
  geom_point(color = "#2563eb", size = 2, alpha = 0.6) +
  # Customize the theme
  theme_minimal() +
  # Customize the labels and title
  labs(
    title = "Ontario COVID-19 Vaccination Progress",
    x = "Date",
    y = "Total Vaccinations",
    caption = "Data source: Ontario vaccination records"
  ) +
  # Format y-axis to millions
  scale_y_continuous(
    labels = function(x) paste0(round(x/1000000, 1), "M"),
    breaks = seq(0, max(vaccination_trend$numtotal_totaldoses_admin), by = 5000000)
  ) +
  # Format x-axis dates
  scale_x_date(
    date_breaks = "2 months",
    date_labels = "%Y-%m"
  ) +
  # Customize the theme further
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "gray90"),
    plot.margin = margin(1, 1, 1, 1, "cm")
  )

# Save the plot if needed
# ggsave("ontario_vaccination_trend.png", width = 12, height = 8, dpi = 300)
```
```

```{r}
write.csv(vaccinations_cleaned, "vaccinations_cleaned.csv", row.names = FALSE)

```
